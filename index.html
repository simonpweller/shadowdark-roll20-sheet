<main>
    <section class="header">
        <h1>ShadowDark</h1>
    </section>
    <section class="name labeled_input">
        <label for="name">Name</label>
        <input class="full_width" type="text" name="attr_name" id="name">
    </section>
    <section class="attributes">
        <div class="attribute strength">
            <label class="attribute_label" for="strength">STR</label>
            <div class="attribute_controls">
                <input type="number" name="attr_strength" id="strength" value="10"> / <span name="attr_strength_mod">0</span>
                <button type="roll" name="roll_strength" value="[[d20+@{strength_mod}]]"></button>
            </div>
        </div>
        <div class="attribute dexterity">
            <label class="attribute_label" for="dexterity">DEX</label>
            <div class="attribute_controls">
                <input type="number" name="attr_dexterity" id="dexterity" value="10"> / <span name="attr_dexterity_mod">0</span>
                <button type="roll" name="roll_dexterity" value="[[d20+@{dexterity_mod}]]"></button>
            </div>
        </div>
        <div class="attribute constitution">
            <label class="attribute_label" for="constitution">CON</label>
            <div class="attribute_controls">
                <input type="number" name="attr_constitution" id="constitution" value="10"> / <span name="attr_constitution_mod">0</span>
                <button type="roll" name="roll_constitution" value="[[d20+@{constitution_mod}]]"></button>
            </div>
        </div>
        <div class="attribute intelligence">
            <label class="attribute_label" for="intelligence">INT</label>
            <div class="attribute_controls">
                <input type="number" name="attr_intelligence" id="intelligence" value="10"> / <span name="attr_intelligence_mod">0</span>
                <button type="roll" name="roll_intelligence" value="[[d20+@{intelligence_mod}]]"></button>
            </div>
        </div>
        <div class="attribute wisdom">
            <label class="attribute_label" for="wisdom">WIS</label>
            <div class="attribute_controls">
                <input type="number" name="attr_wisdom" id="wisdom" value="10"> / <span name="attr_wisdom_mod">0</span>
                <button type="roll" name="roll_wisdom" value="[[d20+@{wisdom_mod}]]"></button>
            </div>
        </div>
        <div class="attribute charisma">
            <label class="attribute_label" for="charisma">CHA</label>
            <div class="attribute_controls">
                <input type="number" name="attr_charisma" id="charisma" value="10"> / <span name="attr_charisma_mod">0</span>
                <button type="roll" name="roll_charisma" value="[[d20+@{charisma_mod}]]"></button>
            </div>
        </div>
    </section>
    <section class="info">
        <div class="ancestry labeled_input">
            <label for="ancestry">Ancestry</label>
            <input class="full_width" type="text" name="attr_ancestry" id="ancestry">
        </div>
        <div class="class labeled_input">
            <label for="class">Class</label>
            <input class="full_width" type="text" name="attr_class" id="class">
        </div>
        <div class="experience">
            <div class="labeled_input">
                <label for="level">Level</label>
                <input class="full_width" type="number" name="attr_level" id="level" value="1">
            </div>
            <div class="labeled_input">
                <label for="xp">XP</label>
                <div class="xp">
                    <input type="number" name="attr_xp" id="xp" value="0"> / <input type="number" name="attr_xp_next" value="10"/>
                </div>
            </div>
        </div>
    </section>
    <section class="defenses">Defenses</section>
    <section class="title">Title</section>
</main>

<script type="text/worker">
    const int = (score) => parseInt(score, 10) || 0

    const stats = ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma']

    stats.forEach(stat => {
        on(`change:${stat}`, () => {
            getAttrs([stat], values => {
                const stat_base = int(values[stat])
                const mod = Math.floor((stat_base - 10) / 2)
                setAttrs({ [`${stat}_mod`]: mod })
            })
        })
    })
</script>