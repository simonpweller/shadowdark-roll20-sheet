<main>
    <section class="header">
        <h1>ShadowDark</h1>
    </section>
    <section class="name labeled_input">
        <label for="name">Name</label>
        <input class="full_width" type="text" name="attr_name" id="name">
    </section>
    <section class="attributes">
        <div class="attribute strength">
            <label class="attribute_label" for="strength">STR</label>
            <div class="attribute_controls">
                <input type="number" name="attr_strength" id="strength" value="10"> / <span name="attr_strength_mod">0</span>
                <button type="roll" name="roll_strength" value="[[d20+@{strength_mod}]]"></button>
            </div>
        </div>
        <div class="attribute dexterity">
            <label class="attribute_label" for="dexterity">DEX</label>
            <div class="attribute_controls">
                <input type="number" name="attr_dexterity" id="dexterity" value="10"> / <span name="attr_dexterity_mod">0</span>
                <button type="roll" name="roll_dexterity" value="[[d20+@{dexterity_mod}]]"></button>
            </div>
        </div>
        <div class="attribute constitution">
            <label class="attribute_label" for="constitution">CON</label>
            <div class="attribute_controls">
                <input type="number" name="attr_constitution" id="constitution" value="10"> / <span name="attr_constitution_mod">0</span>
                <button type="roll" name="roll_constitution" value="[[d20+@{constitution_mod}]]"></button>
            </div>
        </div>
        <div class="attribute intelligence">
            <label class="attribute_label" for="intelligence">INT</label>
            <div class="attribute_controls">
                <input type="number" name="attr_intelligence" id="intelligence" value="10"> / <span name="attr_intelligence_mod">0</span>
                <button type="roll" name="roll_intelligence" value="[[d20+@{intelligence_mod}]]"></button>
            </div>
        </div>
        <div class="attribute wisdom">
            <label class="attribute_label" for="wisdom">WIS</label>
            <div class="attribute_controls">
                <input type="number" name="attr_wisdom" id="wisdom" value="10"> / <span name="attr_wisdom_mod">0</span>
                <button type="roll" name="roll_wisdom" value="[[d20+@{wisdom_mod}]]"></button>
            </div>
        </div>
        <div class="attribute charisma">
            <label class="attribute_label" for="charisma">CHA</label>
            <div class="attribute_controls">
                <input type="number" name="attr_charisma" id="charisma" value="10"> / <span name="attr_charisma_mod">0</span>
                <button type="roll" name="roll_charisma" value="[[d20+@{charisma_mod}]]"></button>
            </div>
        </div>
    </section>
    <section class="info">
        <div class="ancestry labeled_input">
            <label for="ancestry">Ancestry</label>
            <input class="full_width" type="text" name="attr_ancestry" id="ancestry">
        </div>
        <div class="class labeled_input">
            <label for="class">Class</label>
            <input class="full_width" type="text" name="attr_class" id="class">
        </div>
        <div class="experience">
            <div class="labeled_input">
                <label for="level">Level</label>
                <input class="full_width" type="number" name="attr_level" id="level" value="1">
            </div>
            <div class="labeled_input">
                <label for="xp">XP</label>
                <div class="xp">
                    <input type="number" name="attr_xp" id="xp" value="0"> / <input type="number" name="attr_xp_next" value="10"/>
                </div>
            </div>
        </div>
    </section>
    <div class="labeled_input ac">
        <label for="ac">AC</label>
        <input type="number" name="attr_ac" id="ac" value="10">
    </div>
    <div class="labeled_input hp">
        <label for="hp">HP</label>
        <div>
            <input type="number" name="attr_hp" id="hp" value=""> / <input type="number" name="attr_hp_max" value="">
        </div>
    </div>
    <div class="labeled_input attacks">
        <label for="attacks">Attacks</label>
        <textarea name="attr_attacks" id="attacks"></textarea>
    </div>
    <section class="background">
        <div class="labeled_input">
            <label for="title">Title</label>
            <input class="full_width" type="text" name="attr_title" id="title" />
        </div>
        <div class="labeled_input">
            <label for="alignment">Alignment</label>
            <input class="full_width" type="text" name="attr_alignment" id="alignment" />
        </div>
        <div class="labeled_input">
            <label for="char_background">Background</label>
            <input class="full_width" type="text" name="attr_background" id="char_background" />
        </div>
        <div class="labeled_input">
            <label for="deity">Deity</label>
            <input class="full_width" type="text" name="attr_deity" id="deity" />
        </div>
    </section>
    <div class="labeled_input talents">
        <label for="talents">Talents / Spells</label>
        <textarea name="attr_talents" id="talents"></textarea>
    </div>
    <div class="labeled_input gear">
        <div class="equipment-header">
            <label>Gear</label>
            <div class="coin-field">
                <label for="gold">GP</label>
                <input type="number" name="attr_gold" id="gold" value="0" />
            </div>
            <div class="coin-field">
                <label for="silver">SP</label>
                <input type="number" name="attr_silver" id="silver" value="0" />
            </div>
            <div class="coin-field">
                <label for="copper">CP</label>
                <input type="number" name="attr_copper" id="copper" value="0" />
            </div>
        </div>
        <div class="equipment">
            <div class="col">
                <div class="row">
                    <label for="equipment_slot_1"> 1.</label>
                    <input type="text" name="attr_equipment_slot_1" id="equipment_slot_1" />
                </div>
                <div class="row">
                    <label for="equipment_slot_2"> 2.</label>
                    <input type="text" name="attr_equipment_slot_2" id="equipment_slot_2" />
                </div>
                <div class="row">
                    <label for="equipment_slot_3"> 3.</label>
                    <input type="text" name="attr_equipment_slot_3" id="equipment_slot_3" />
                </div>
                <div class="row">
                    <label for="equipment_slot_4"> 4.</label>
                    <input type="text" name="attr_equipment_slot_4" id="equipment_slot_4" />
                </div>
                <div class="row">
                    <label for="equipment_slot_5"> 5.</label>
                    <input type="text" name="attr_equipment_slot_5" id="equipment_slot_5" />
                </div>
                <div class="row">
                    <label for="equipment_slot_6"> 6.</label>
                    <input type="text" name="attr_equipment_slot_6" id="equipment_slot_6" />
                </div>
                <div class="row">
                    <label for="equipment_slot_7"> 7.</label>
                    <input type="text" name="attr_equipment_slot_7" id="equipment_slot_7" />
                </div>
                <div class="row">
                    <label for="equipment_slot_8"> 8.</label>
                    <input type="text" name="attr_equipment_slot_8" id="equipment_slot_8" />
                </div>
                <div class="row">
                    <label for="equipment_slot_9"> 9.</label>
                    <input type="text" name="attr_equipment_slot_9" id="equipment_slot_9" />
                </div>
                <div class="row">
                    <label for="equipment_slot_10">10.</label>
                    <input type="text" name="attr_equipment_slot_10" id="equipment_slot_10" />
                </div>
            </div>
            <div class="col">
                <div class="row">
                    <label for="equipment_slot_11">11.</label>
                    <input type="text" name="attr_equipment_slot_11" id="equipment_slot_11" />
                </div>
                <div class="row">
                    <label for="equipment_slot_12">12.</label>
                    <input type="text" name="attr_equipment_slot_12" id="equipment_slot_12" />
                </div>
                <div class="row">
                    <label for="equipment_slot_13">13.</label>
                    <input type="text" name="attr_equipment_slot_13" id="equipment_slot_13" />
                </div>
                <div class="row">
                    <label for="equipment_slot_14">14.</label>
                    <input type="text" name="attr_equipment_slot_14" id="equipment_slot_14" />
                </div>
                <div class="row">
                    <label for="equipment_slot_15">15.</label>
                    <input type="text" name="attr_equipment_slot_15" id="equipment_slot_15" />
                </div>
                <div class="row">
                    <label for="equipment_slot_16">16.</label>
                    <input type="text" name="attr_equipment_slot_16" id="equipment_slot_16" />
                </div>
                <div class="row">
                    <label for="equipment_slot_17">17.</label>
                    <input type="text" name="attr_equipment_slot_17" id="equipment_slot_17" />
                </div>
                <div class="row">
                    <label for="equipment_slot_18">18.</label>
                    <input type="text" name="attr_equipment_slot_18" id="equipment_slot_18" />
                </div>
                <div class="row">
                    <label for="equipment_slot_19">19.</label>
                    <input type="text" name="attr_equipment_slot_19" id="equipment_slot_19" />
                </div>
                <div class="row">
                    <label for="equipment_slot_20">20.</label>
                    <input type="text" name="attr_equipment_slot_20" id="equipment_slot_20" />
                </div>
            </div>
            <div class="col free-to-carry">
                <label for="free_to_carry">Free to carry</label>
                <textarea name="attr_free_to_carry" id="free_to_carry"></textarea>
            </div>
        </div>
    </div>
</main>

<script type="text/worker">
    const int = (score) => parseInt(score, 10) || 0

    const stats = ['strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma']

    stats.forEach(stat => {
        on(`change:${stat}`, () => {
            getAttrs([stat], values => {
                const stat_base = int(values[stat])
                const mod = Math.floor((stat_base - 10) / 2)
                setAttrs({ [`${stat}_mod`]: mod })
            })
        })
    })
</script>